<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta name="x-ua-compatible" content="ie=edge">
  <title itemprop="name">backbone.marionette.js</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#b91d47">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" media="all" href="../../styles/docco.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.860affb898b6e45b.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>backbone.marionette.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Backbone.Marionette v0.9.4</p>
<p>Copyright (C)2012 Derick Bailey, Muted Solutions, LLC
Distributed Under MIT License</p>
<p>Documentation and Full License Available at:
<a href="http://github.com/derickbailey/backbone.marionette">http://github.com/derickbailey/backbone.marionette</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Backbone.Marionette = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Backbone, _, $</span>)</span>{
  <span class="hljs-keyword">var</span> Marionette = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="eventbinder">EventBinder</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The event binder facilitates the binding and unbinding of events
from objects that extend <code>Backbone.Events</code>. It makes
unbinding events, even with anonymous callback functions,
easy. </p>
<p>Inspired by <a href="http://stackoverflow.com/questions/7567404/backbone-js-repopulate-or-recreate-the-view/7607853#7607853">Johnny Oshika</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Marionette.EventBinder = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">this</span>._eventBindings = [];
};

_.extend(Marionette.EventBinder.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Store the event binding in array so it can be unbound
easily, at a later point in time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  bindTo: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj, eventName, callback, context</span>) </span>{
    context = context || <span class="hljs-keyword">this</span>;
    obj.on(eventName, callback, context);

    <span class="hljs-keyword">var</span> binding = { 
      <span class="hljs-attr">obj</span>: obj, 
      <span class="hljs-attr">eventName</span>: eventName, 
      <span class="hljs-attr">callback</span>: callback, 
      <span class="hljs-attr">context</span>: context 
    }

    <span class="hljs-keyword">this</span>._eventBindings.push(binding);

    <span class="hljs-keyword">return</span> binding;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Unbind from a single binding object. Binding objects are
returned from the <code>bindTo</code> method call. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unbindFrom: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">binding</span>)</span>{
    binding.obj.off(binding.eventName, binding.callback, binding.context);
    <span class="hljs-keyword">this</span>._eventBindings = _.reject(<span class="hljs-keyword">this</span>._eventBindings, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bind</span>)</span>{<span class="hljs-keyword">return</span> bind === binding});
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Unbind all of the events that we have stored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unbindAll: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The <code>unbindFrom</code> call removes elements from the array
while it is being iterated, so clone it first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> bindings = _.map(<span class="hljs-keyword">this</span>._eventBindings, _.identity);
    _.each(bindings, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">binding, index</span>) </span>{
      that.unbindFrom(binding);
    });
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Copy the <code>extend</code> function used by Backbone’s classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.EventBinder.extend = Backbone.View.extend;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="marionette-view">Marionette.View</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>The core view type that other Marionette views extend from.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.View = Backbone.View.extend({
  <span class="hljs-attr">constructor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    Backbone.View.prototype.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

    <span class="hljs-keyword">var</span> eventBinder = <span class="hljs-keyword">new</span> Marionette.EventBinder();
    _.extend(<span class="hljs-keyword">this</span>, eventBinder);

    <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>, <span class="hljs-string">"show"</span>, <span class="hljs-keyword">this</span>.onShowCalled, <span class="hljs-keyword">this</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Get the template for this view
instance. You can set a <code>template</code> attribute in the view
definition or pass a <code>template: &quot;whatever&quot;</code> parameter in
to the constructor options. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getTemplate: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> template;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Get the template from <code>this.options.template</code> or
<code>this.template</code>. The <code>options</code> takes precedence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options &amp;&amp; <span class="hljs-keyword">this</span>.options.template){
      template = <span class="hljs-keyword">this</span>.options.template;
    } <span class="hljs-keyword">else</span> {
      template = <span class="hljs-keyword">this</span>.template;
    }

    <span class="hljs-keyword">return</span> template;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Serialize the model or collection for the view. If a model is
found, <code>.toJSON()</code> is called. If a collection is found, <code>.toJSON()</code>
is also called, but is used to populate an <code>items</code> array in the
resulting data. If both are found, defaults to the model. 
You can override the <code>serializeData</code> method in your own view 
definition, to provide custom serialization for your view’s data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  serializeData: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> data;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.model) { 
      data = <span class="hljs-keyword">this</span>.model.toJSON(); 
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection) {
      data = { <span class="hljs-attr">items</span>: <span class="hljs-keyword">this</span>.collection.toJSON() };
    }

    data = <span class="hljs-keyword">this</span>.mixinTemplateHelpers(data);

    <span class="hljs-keyword">return</span> data;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Mix in template helper methods. Looks for a
<code>templateHelpers</code> attribute, which can either be an
object literal, or a function that returns an object
literal. All methods and attributes from this object
are copies to the object passed in.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mixinTemplateHelpers: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">target</span>)</span>{
    target = target || {};
    <span class="hljs-keyword">var</span> templateHelpers = <span class="hljs-keyword">this</span>.templateHelpers;
    <span class="hljs-keyword">if</span> (_.isFunction(templateHelpers)){
      templateHelpers = templateHelpers.call(<span class="hljs-keyword">this</span>);
    }
    <span class="hljs-keyword">return</span> _.extend(target, templateHelpers);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Configure <code>triggers</code> to forward DOM events to view
events. <code>triggers: {&quot;click .foo&quot;: &quot;do:foo&quot;}</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  configureTriggers: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.triggers) { <span class="hljs-keyword">return</span>; }

    <span class="hljs-keyword">var</span> triggers = <span class="hljs-keyword">this</span>.triggers;
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> triggerEvents = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Allow <code>triggers</code> to be configured as a function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (_.isFunction(triggers)){ triggers = triggers.call(<span class="hljs-keyword">this</span>); }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Configure the triggers, prevent default
action and stop propagation of DOM events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(triggers, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>)</span>{

      triggerEvents[key] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
        <span class="hljs-keyword">if</span> (e &amp;&amp; e.preventDefault){ e.preventDefault(); }
        <span class="hljs-keyword">if</span> (e &amp;&amp; e.stopPropagation){ e.stopPropagation(); }
        that.trigger(value);
      }

    });

    <span class="hljs-keyword">return</span> triggerEvents;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Overriding Backbone.View’s delegateEvents specifically
to handle the <code>triggers</code> configuration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  delegateEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">events</span>)</span>{
    events = events || <span class="hljs-keyword">this</span>.events;
    <span class="hljs-keyword">if</span> (_.isFunction(events)){ events = events.call(<span class="hljs-keyword">this</span>)}

    <span class="hljs-keyword">var</span> combinedEvents = {};
    <span class="hljs-keyword">var</span> triggers = <span class="hljs-keyword">this</span>.configureTriggers();
    _.extend(combinedEvents, events, triggers);

    Backbone.View.prototype.delegateEvents.call(<span class="hljs-keyword">this</span>, combinedEvents);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Internal method, handles the <code>show</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  onShowCalled: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Default <code>close</code> implementation, for removing a view from the
DOM and unbinding it. Regions will call this method
for you. You can specify an <code>onClose</code> method in your view to
add custom code that is called after the view is closed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  close: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.beforeClose) { <span class="hljs-keyword">this</span>.beforeClose(); }

    <span class="hljs-keyword">this</span>.remove();

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onClose) { <span class="hljs-keyword">this</span>.onClose(); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'close'</span>);
    <span class="hljs-keyword">this</span>.unbindAll();
    <span class="hljs-keyword">this</span>.unbind();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>This method binds the elements specified in the “ui” hash inside the view’s code with
the associated jQuery selectors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  bindUIElements: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.ui) { <span class="hljs-keyword">return</span>; }

    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.uiBindings) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>We want to store the ui hash in uiBindings, since afterwards the values in the ui hash
will be overridden with jQuery selectors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.uiBindings = <span class="hljs-keyword">this</span>.ui;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>refreshing the associated selectors since they should point to the newly rendered elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.ui = {};
    _.each(_.keys(<span class="hljs-keyword">this</span>.uiBindings), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
      <span class="hljs-keyword">var</span> selector = that.uiBindings[key];
      that.ui[key] = that.$(selector);
    });
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2 id="item-view">Item View</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>A single item view implementation that contains code for rendering
with underscore.js templates, serializing the view’s model or collection,
and calling several methods on extended views, such as <code>onRender</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.ItemView =  Marionette.View.extend({
  <span class="hljs-attr">constructor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    Marionette.View.prototype.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.initialEvents();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Configured the initial events that the item view 
binds to. Override this method to prevent the initial
events, or to add your own initial events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initialEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection){
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"reset"</span>, <span class="hljs-keyword">this</span>.render, <span class="hljs-keyword">this</span>);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Render the view, defaulting to underscore.js templates.
You can override this in your view definition to provide
a very specific rendering for your view. In general, though,
you should override the <code>Marionette.Renderer</code> object to
change how Marionette renders views.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.beforeRender){ <span class="hljs-keyword">this</span>.beforeRender(); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"before:render"</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"item:before:render"</span>, <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.serializeData();
    <span class="hljs-keyword">var</span> template = <span class="hljs-keyword">this</span>.getTemplate();
    <span class="hljs-keyword">var</span> html = Marionette.Renderer.render(template, data);
    <span class="hljs-keyword">this</span>.$el.html(html);
    <span class="hljs-keyword">this</span>.bindUIElements();

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onRender){ <span class="hljs-keyword">this</span>.onRender(); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"render"</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"item:rendered"</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Override the default close event to add a few
more events that are triggered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  close: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'item:before:close'</span>);
    Marionette.View.prototype.close.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'item:closed'</span>);
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h2 id="collection-view">Collection View</h2>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>A view that iterates over a Backbone.Collection
and renders an individual ItemView for each model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.CollectionView = Marionette.View.extend({
  <span class="hljs-attr">constructor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    Marionette.View.prototype.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.initChildViewStorage();
    <span class="hljs-keyword">this</span>.initialEvents();
    <span class="hljs-keyword">this</span>.onShowCallbacks = <span class="hljs-keyword">new</span> Marionette.Callbacks();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Configured the initial events that the collection view 
binds to. Override this method to prevent the initial
events, or to add your own initial events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initialEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection){
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"add"</span>, <span class="hljs-keyword">this</span>.addChildView, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"remove"</span>, <span class="hljs-keyword">this</span>.removeItemView, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"reset"</span>, <span class="hljs-keyword">this</span>.render, <span class="hljs-keyword">this</span>);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Handle a child item added to the collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addChildView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item, collection, options</span>)</span>{
    <span class="hljs-keyword">this</span>.closeEmptyView();
    <span class="hljs-keyword">var</span> ItemView = <span class="hljs-keyword">this</span>.getItemView();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.addItemView(item, ItemView, options.index);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Override from <code>Marionette.View</code> to guarantee the <code>onShow</code> method
of child views is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  onShowCalled: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">this</span>.onShowCallbacks.run();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Internal method to trigger the before render callbacks
and events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  triggerBeforeRender: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.beforeRender) { <span class="hljs-keyword">this</span>.beforeRender(); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"before:render"</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"collection:before:render"</span>, <span class="hljs-keyword">this</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Internal method to trigger the rendered callbacks and
events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  triggerRendered: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onRender) { <span class="hljs-keyword">this</span>.onRender(); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"render"</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"collection:rendered"</span>, <span class="hljs-keyword">this</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Render the collection of items. Override this method to
provide your own implementation of a render function for
the collection view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">this</span>.triggerBeforeRender();
    <span class="hljs-keyword">this</span>.closeEmptyView();
    <span class="hljs-keyword">this</span>.closeChildren();

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection &amp;&amp; <span class="hljs-keyword">this</span>.collection.length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.showCollection();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.showEmptyView();
    }

    <span class="hljs-keyword">this</span>.triggerRendered();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Internal method to loop through each item in the
collection view and show it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  showCollection: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> ItemView = <span class="hljs-keyword">this</span>.getItemView();
    <span class="hljs-keyword">this</span>.collection.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>)</span>{
      that.addItemView(item, ItemView, index);
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Internal method to show an empty view in place of
a collection of item views, when the collection is
empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  showEmptyView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> EmptyView = <span class="hljs-keyword">this</span>.options.emptyView || <span class="hljs-keyword">this</span>.emptyView;
    <span class="hljs-keyword">if</span> (EmptyView &amp;&amp; !<span class="hljs-keyword">this</span>._showingEmptyView){
      <span class="hljs-keyword">this</span>._showingEmptyView = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">new</span> Backbone.Model();
      <span class="hljs-keyword">this</span>.addItemView(model, EmptyView, <span class="hljs-number">0</span>);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Internal method to close an existing emptyView instance
if one exists. Called when a collection view has been
rendered empty, and then an item is added to the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  closeEmptyView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._showingEmptyView){
      <span class="hljs-keyword">this</span>.closeChildren();
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._showingEmptyView;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Retrieve the itemView type, either from <code>this.options.itemView</code>
or from the <code>itemView</code> in the object definition. The “options”
takes precedence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getItemView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> itemView = <span class="hljs-keyword">this</span>.options.itemView || <span class="hljs-keyword">this</span>.itemView;

    <span class="hljs-keyword">if</span> (!itemView){
      <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"An `itemView` must be specified"</span>);
      err.name = <span class="hljs-string">"NoItemViewError"</span>;
      <span class="hljs-keyword">throw</span> err;
    }

    <span class="hljs-keyword">return</span> itemView;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Render the child item’s view and add it to the
HTML for the collection view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addItemView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item, ItemView, index</span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">this</span>.buildItemView(item, ItemView);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Store the child view itself so we can properly 
remove and/or close it later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.storeChild(view);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onItemAdded){ <span class="hljs-keyword">this</span>.onItemAdded(view); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"item:added"</span>, view);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Render it and show it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> renderResult = <span class="hljs-keyword">this</span>.renderItemView(view, index);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>call onShow for child item views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (view.onShow){
      <span class="hljs-keyword">this</span>.onShowCallbacks.add(view.onShow, view);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Forward all child item view events through the parent,
prepending “itemview:” to the event name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> childBinding = <span class="hljs-keyword">this</span>.bindTo(view, <span class="hljs-string">"all"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">var</span> args = slice.call(<span class="hljs-built_in">arguments</span>);
      args[<span class="hljs-number">0</span>] = <span class="hljs-string">"itemview:"</span> + args[<span class="hljs-number">0</span>];
      args.splice(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, view);

      that.trigger.apply(that, args);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Store all child event bindings so we can unbind
them when removing / closing the child view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.childBindings = <span class="hljs-keyword">this</span>.childBindings || {};
    <span class="hljs-keyword">this</span>.childBindings[view.cid] = childBinding;
    
    <span class="hljs-keyword">return</span> renderResult;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>render the item view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  renderItemView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view, index</span>) </span>{
    view.render();
    <span class="hljs-keyword">this</span>.appendHtml(<span class="hljs-keyword">this</span>, view, index);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Build an <code>itemView</code> for every model in the collection. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  buildItemView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item, ItemView</span>)</span>{
    <span class="hljs-keyword">var</span> itemViewOptions = _.result(<span class="hljs-keyword">this</span>, <span class="hljs-string">"itemViewOptions"</span>);
    <span class="hljs-keyword">var</span> options = _.extend({<span class="hljs-attr">model</span>: item}, itemViewOptions);
    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">new</span> ItemView(options);
    <span class="hljs-keyword">return</span> view;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Remove the child view and close it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeItemView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)</span>{
    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">this</span>.children[item.cid];
    <span class="hljs-keyword">if</span> (view){
      <span class="hljs-keyword">var</span> childBinding = <span class="hljs-keyword">this</span>.childBindings[view.cid];
      <span class="hljs-keyword">if</span> (childBinding) {
        <span class="hljs-keyword">this</span>.unbindFrom(childBinding);
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.childBindings[view.cid];
      }
      view.close();
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.children[item.cid];
    }

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.collection || <span class="hljs-keyword">this</span>.collection.length === <span class="hljs-number">0</span>){
      <span class="hljs-keyword">this</span>.showEmptyView();
    }

    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"item:removed"</span>, view);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Append the HTML to the collection’s <code>el</code>.
Override this method to do something other
then <code>.append</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  appendHtml: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">collectionView, itemView, index</span>)</span>{
    collectionView.$el.append(itemView.el);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Store references to all of the child <code>itemView</code>
instances so they can be managed and cleaned up, later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  storeChild: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>)</span>{
    <span class="hljs-keyword">this</span>.children[view.model.cid] = view;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Internal method to set up the <code>children</code> object for
storing all of the child views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initChildViewStorage: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">this</span>.children = {};
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Handle cleanup and other closing needs for
the collection of views.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  close: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"collection:before:close"</span>);
    <span class="hljs-keyword">this</span>.closeChildren();
    Marionette.View.prototype.close.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"collection:closed"</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Close the child views that this collection view
is holding on to, if any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  closeChildren: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.children){
      _.each(_.clone(<span class="hljs-keyword">this</span>.children), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">childView</span>)</span>{
        that.removeItemView(childView.model);
      });
    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <h2 id="composite-view">Composite View</h2>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Used for rendering a branch-leaf, hierarchical structure.
Extends directly from CollectionView and also renders an
an item view as <code>modelView</code>, for the top leaf</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.CompositeView = Marionette.CollectionView.extend({
  <span class="hljs-attr">constructor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
    Marionette.CollectionView.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.itemView = <span class="hljs-keyword">this</span>.getItemView();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Configured the initial events that the composite view 
binds to. Override this method to prevent the initial
events, or to add your own initial events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initialEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection){
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"add"</span>, <span class="hljs-keyword">this</span>.addChildView, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"remove"</span>, <span class="hljs-keyword">this</span>.removeItemView, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.bindTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"reset"</span>, <span class="hljs-keyword">this</span>.renderCollection, <span class="hljs-keyword">this</span>);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Retrieve the <code>itemView</code> to be used when rendering each of
the items in the collection. The default is to return
<code>this.itemView</code> or Marionette.CompositeView if no <code>itemView</code>
has been defined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getItemView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.itemView || <span class="hljs-keyword">this</span>.constructor;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Renders the model once, and the collection once. Calling
this again will tell the model’s view to re-render itself
but the collection will not re-render.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">this</span>.resetItemViewContainer();

    <span class="hljs-keyword">var</span> html = <span class="hljs-keyword">this</span>.renderModel();
    <span class="hljs-keyword">this</span>.$el.html(html);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>the ui bindings is done here and not at the end of render since they should be
available before the collection is rendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.bindUIElements();
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"composite:model:rendered"</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"render"</span>);

    <span class="hljs-keyword">this</span>.renderCollection();
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"composite:rendered"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Render the collection for the composite view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  renderCollection: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    Marionette.CollectionView.prototype.render.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"composite:collection:rendered"</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Render an individual model, if we have one, as
part of a composite view (branch / leaf). For example:
a treeview.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  renderModel: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> data = {};
    data = <span class="hljs-keyword">this</span>.serializeData();

    <span class="hljs-keyword">var</span> template = <span class="hljs-keyword">this</span>.getTemplate();
    <span class="hljs-keyword">return</span> Marionette.Renderer.render(template, data);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Appends the <code>el</code> of itemView instances to the specified
<code>itemViewContainer</code> (a jQuery selector). Override this method to
provide custom logic of how the child item view instances have their
HTML appended to the composite view instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  appendHtml: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cv, iv</span>)</span>{
    <span class="hljs-keyword">var</span> $container = <span class="hljs-keyword">this</span>.getItemViewContainer(cv);
    $container.append(iv.el);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Internal method to ensure an <code>$itemViewContainer</code> exists, for the
<code>appendHtml</code> method to use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getItemViewContainer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">containerView</span>)</span>{
    <span class="hljs-keyword">var</span> container;
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"$itemViewContainer"</span> <span class="hljs-keyword">in</span> containerView){
      container = containerView.$itemViewContainer;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (containerView.itemViewContainer){
        container = containerView.$(_.result(containerView, <span class="hljs-string">"itemViewContainer"</span>));

        <span class="hljs-keyword">if</span> (container.length &lt;= <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Missing `itemViewContainer`"</span>);
          err.name = <span class="hljs-string">"ItemViewContainerMissingError"</span>;
          <span class="hljs-keyword">throw</span> err;
        }
      } <span class="hljs-keyword">else</span> {
        container = containerView.$el;
      }
      containerView.$itemViewContainer = container;
    }
    <span class="hljs-keyword">return</span> container;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Internal method to reset the <code>$itemViewContainer</code> on render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  resetItemViewContainer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$itemViewContainer){
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.$itemViewContainer;
    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <h2 id="region-">Region </h2>

            </div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Manage the visual regions of your composite application. See
<a href="http://lostechies.com/derickbailey/2011/12/12/composite-js-apps-regions-and-region-managers/">http://lostechies.com/derickbailey/2011/12/12/composite-js-apps-regions-and-region-managers/</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Region = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
  <span class="hljs-keyword">this</span>.options = options || {};

  <span class="hljs-keyword">var</span> eventBinder = <span class="hljs-keyword">new</span> Marionette.EventBinder();
  _.extend(<span class="hljs-keyword">this</span>, eventBinder, options);

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.el){
    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"An 'el' must be specified"</span>);
    err.name = <span class="hljs-string">"NoElError"</span>;
    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.initialize){
    <span class="hljs-keyword">this</span>.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  }
};

_.extend(Marionette.Region.prototype, Backbone.Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Displays a backbone view instance inside of the region.
Handles calling the <code>render</code> method for you. Reads content
directly from the <code>el</code> attribute. Also calls an optional
<code>onShow</code> and <code>close</code> method on your view, just after showing
or just before closing the view, respectively.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  show: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>)</span>{

    <span class="hljs-keyword">this</span>.ensureEl();
    <span class="hljs-keyword">this</span>.close();

    view.render();
    <span class="hljs-keyword">this</span>.open(view);

    <span class="hljs-keyword">if</span> (view.onShow) { view.onShow(); }
    view.trigger(<span class="hljs-string">"show"</span>);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onShow) { <span class="hljs-keyword">this</span>.onShow(view); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"view:show"</span>, view);

    <span class="hljs-keyword">this</span>.currentView = view;
  },

  <span class="hljs-attr">ensureEl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$el || <span class="hljs-keyword">this</span>.$el.length === <span class="hljs-number">0</span>){
      <span class="hljs-keyword">this</span>.$el = <span class="hljs-keyword">this</span>.getEl(<span class="hljs-keyword">this</span>.el);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Override this method to change how the region finds the
DOM element that it manages. Return a jQuery selector object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getEl: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selector</span>)</span>{
    <span class="hljs-keyword">return</span> $(selector);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Override this method to change how the new view is
appended to the <code>$el</code> that the region is managing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  open: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>)</span>{
    <span class="hljs-keyword">this</span>.$el.html(view.el);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Close the current view, if there is one. If there is no
current view, it does nothing and returns immediately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  close: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">this</span>.currentView;
    <span class="hljs-keyword">if</span> (!view){ <span class="hljs-keyword">return</span>; }

    <span class="hljs-keyword">if</span> (view.close) { view.close(); }
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"view:closed"</span>, view);

    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.currentView;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Attach an existing view to the region. This 
will not call <code>render</code> or <code>onShow</code> for the new view, 
and will not replace the current HTML for the <code>el</code>
of the region.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  attachView: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>)</span>{
    <span class="hljs-keyword">this</span>.currentView = view;
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Copy the <code>extend</code> function used by Backbone’s classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Region.extend = Backbone.View.extend;</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <h2 id="layout">Layout</h2>

            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Used for managing application layouts, nested layouts and
multiple regions within an application or sub-application.</p>
<p>A specialized view type that renders an area of HTML and then
attaches <code>Region</code> instances to the specified <code>regions</code>.
Used for composite view management and sub-application areas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Layout = Marionette.ItemView.extend({
  <span class="hljs-attr">regionType</span>: Backbone.Marionette.Region,

  <span class="hljs-attr">constructor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    Backbone.Marionette.ItemView.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.initializeRegions();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Layout’s render will use the existing region objects the
first time it is called. Subsequent calls will close the
views that the regions are showing and then reset the <code>el</code>
for the regions to the newly rendered DOM elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> result = Marionette.ItemView.prototype.render.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Rewrite this function to handle re-rendering and
re-initializing the <code>el</code> for each region</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.render = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">this</span>.closeRegions();
      <span class="hljs-keyword">this</span>.reInitializeRegions();

      <span class="hljs-keyword">var</span> result = Marionette.ItemView.prototype.render.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">return</span> result;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Handle closing regions, and then close the view itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  close: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.closeRegions();
    <span class="hljs-keyword">this</span>.destroyRegions();
    Backbone.Marionette.ItemView.prototype.close.call(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Initialize the regions that have been defined in a
<code>regions</code> attribute on this layout. The key of the
hash becomes an attribute on the layout object directly.
For example: <code>regions: { menu: &quot;.menu-container&quot; }</code>
will product a <code>layout.menu</code> object which is a region
that controls the <code>.menu-container</code> DOM element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initializeRegions: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.regionManagers){
      <span class="hljs-keyword">this</span>.regionManagers = {};
    }

    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    _.each(<span class="hljs-keyword">this</span>.regions, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">region, name</span>) </span>{
      <span class="hljs-keyword">if</span> (    <span class="hljs-keyword">typeof</span> region != <span class="hljs-string">'string'</span> 
           &amp;&amp; <span class="hljs-keyword">typeof</span> region.selector != <span class="hljs-string">'string'</span> ) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">'Region must be specified as a selector '</span> +
                            <span class="hljs-string">'string or an object with selector property'</span>);
      }

      selector = <span class="hljs-keyword">typeof</span> region === <span class="hljs-string">'string'</span> ? region : region.selector;
      <span class="hljs-keyword">var</span> regionType = <span class="hljs-keyword">typeof</span> region.regionType === <span class="hljs-string">'undefined'</span> 
        ? that.regionType : region.regionType 
      
      <span class="hljs-keyword">var</span> regionManager = <span class="hljs-keyword">new</span> regionType({
        <span class="hljs-attr">el</span>: selector,
          <span class="hljs-attr">getEl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selector</span>)</span>{
            <span class="hljs-keyword">return</span> that.$(selector);
          }
      });

      that.regionManagers[name] = regionManager;
      that[name] = regionManager;
    });

  },</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Re-initialize all of the regions by updating the <code>el</code> that
they point to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reInitializeRegions: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.regionManagers &amp;&amp; _.size(<span class="hljs-keyword">this</span>.regionManagers)===<span class="hljs-number">0</span>){
      <span class="hljs-keyword">this</span>.initializeRegions();
    } <span class="hljs-keyword">else</span> {
      _.each(<span class="hljs-keyword">this</span>.regionManagers, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">region</span>)</span>{
        <span class="hljs-keyword">delete</span> region.$el;
      });
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Close all of the regions that have been opened by
this layout. This method is called when the layout
itself is closed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  closeRegions: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    _.each(<span class="hljs-keyword">this</span>.regionManagers, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">manager, name</span>) </span>{
      manager.close();
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Destroys all of the regions by removing references
from the Layout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  destroyRegions: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    _.each(<span class="hljs-keyword">this</span>.regionManagers, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">manager, name</span>) </span>{
      <span class="hljs-keyword">delete</span> that[name];
    });
    <span class="hljs-keyword">this</span>.regionManagers = {};
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <h2 id="application">Application</h2>

            </div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Contain and manage the composite application as a whole.
Stores and starts up <code>Region</code> objects, includes an
event aggregator as <code>app.vent</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Application = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
  <span class="hljs-keyword">this</span>.initCallbacks = <span class="hljs-keyword">new</span> Marionette.Callbacks();
  <span class="hljs-keyword">this</span>.vent = <span class="hljs-keyword">new</span> Marionette.EventAggregator();
  <span class="hljs-keyword">this</span>.submodules = {};

  <span class="hljs-keyword">var</span> eventBinder = <span class="hljs-keyword">new</span> Marionette.EventBinder();
  _.extend(<span class="hljs-keyword">this</span>, eventBinder, options);
};

_.extend(Marionette.Application.prototype, Backbone.Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Add an initializer that is either run at when the <code>start</code>
method is called, or run immediately if added after <code>start</code>
has already been called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addInitializer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">initializer</span>)</span>{
    <span class="hljs-keyword">this</span>.initCallbacks.add(initializer);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>kick off all of the application’s processes.
initializes all of the regions that have been added
to the app, and runs all of the initializer functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  start: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"initialize:before"</span>, options);
    <span class="hljs-keyword">this</span>.initCallbacks.run(options, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"initialize:after"</span>, options);

    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"start"</span>, options);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Add regions to your app. 
Accepts a hash of named strings or Region objects
addRegions({something: “#someRegion”})
addRegions{{something: Region.extend({el: “#someRegion”}) });</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addRegions: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">regions</span>)</span>{
    <span class="hljs-keyword">var</span> regionValue, regionObj, region;

    <span class="hljs-keyword">for</span>(region <span class="hljs-keyword">in</span> regions){
      <span class="hljs-keyword">if</span> (regions.hasOwnProperty(region)){
        regionValue = regions[region];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> regionValue === <span class="hljs-string">"string"</span>){
          regionObj = <span class="hljs-keyword">new</span> Marionette.Region({
            <span class="hljs-attr">el</span>: regionValue
          });
        } <span class="hljs-keyword">else</span> {
          regionObj = <span class="hljs-keyword">new</span> regionValue();
        }

        <span class="hljs-keyword">this</span>[region] = regionObj;
      }
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Removes a region from your app.
Accepts the regions name
removeRegion(‘myRegion’)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeRegion: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">region</span>) </span>{
    <span class="hljs-keyword">this</span>[region].close();
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>[region]
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Create a module, attached to the application</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">module</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">moduleNames, moduleDefinition</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>slice the args, and add this application object as the
first argument of the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> args = slice.call(<span class="hljs-built_in">arguments</span>);
    args.unshift(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>see the Marionette.Module object for more information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> Marionette.Module.create.apply(Marionette.Module, args);
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Copy the <code>extend</code> function used by Backbone’s classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Application.extend = Backbone.View.extend;</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <h2 id="approuter">AppRouter</h2>

            </div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Reduce the boilerplate code of handling route events
and then calling a single method on another object.
Have your routers configured to call the method on
your object, directly.</p>
<p>Configure an AppRouter with <code>appRoutes</code>.</p>
<p>App routers can only take one <code>controller</code> object. 
It is recommended that you divide your controller
objects in to smaller peices of related functionality
and have multiple routers / controllers, instead of
just one giant router and controller.</p>
<p>You can also add standard routes to an AppRouter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Marionette.AppRouter = Backbone.Router.extend({

  <span class="hljs-attr">constructor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
    Backbone.Router.prototype.constructor.call(<span class="hljs-keyword">this</span>, options);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.appRoutes){
      <span class="hljs-keyword">var</span> controller = <span class="hljs-keyword">this</span>.controller;
      <span class="hljs-keyword">if</span> (options &amp;&amp; options.controller) {
        controller = options.controller;
      }
      <span class="hljs-keyword">this</span>.processAppRoutes(controller, <span class="hljs-keyword">this</span>.appRoutes);
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Internal method to process the <code>appRoutes</code> for the
router, and turn them in to routes that trigger the
specified method on the specified <code>controller</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  processAppRoutes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">controller, appRoutes</span>)</span>{
    <span class="hljs-keyword">var</span> method, methodName;
    <span class="hljs-keyword">var</span> route, routesLength, i;
    <span class="hljs-keyword">var</span> routes = [];
    <span class="hljs-keyword">var</span> router = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">for</span>(route <span class="hljs-keyword">in</span> appRoutes){
      <span class="hljs-keyword">if</span> (appRoutes.hasOwnProperty(route)){
        routes.unshift([route, appRoutes[route]]);
      }
    }

    routesLength = routes.length;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; routesLength; i++){
      route = routes[i][<span class="hljs-number">0</span>];
      methodName = routes[i][<span class="hljs-number">1</span>];
      method = controller[methodName];

      <span class="hljs-keyword">if</span> (!method){
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"Method '"</span> + methodName + <span class="hljs-string">"' was not found on the controller"</span>;
        <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(msg);
        err.name = <span class="hljs-string">"NoMethodError"</span>;
        <span class="hljs-keyword">throw</span> err;
      }

      method = _.bind(method, controller);
      router.route(route, methodName, method);
    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <h2 id="module">Module</h2>

            </div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>A simple module system, used to create privacy and encapsulation in
Marionette applications</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Module = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">moduleName, app, customArgs</span>)</span>{
  <span class="hljs-keyword">this</span>.moduleName = moduleName;</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>store sub-modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.submodules = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>callbacks for initializers and finalizers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>._initializerCallbacks = <span class="hljs-keyword">new</span> Marionette.Callbacks();
  <span class="hljs-keyword">this</span>._finalizerCallbacks = <span class="hljs-keyword">new</span> Marionette.Callbacks();</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>store the configuration for this module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>._config = {};
  <span class="hljs-keyword">this</span>._config.app = app;
  <span class="hljs-keyword">this</span>._config.customArgs = customArgs;
  <span class="hljs-keyword">this</span>._config.definitions = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>extend this module with an event binder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> eventBinder = <span class="hljs-keyword">new</span> Marionette.EventBinder();
  _.extend(<span class="hljs-keyword">this</span>, eventBinder);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Extend the Module prototype with events / bindTo, so that the module
can be used as an event aggregator or pub/sub.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.extend(Marionette.Module.prototype, Backbone.Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Initializer for a specific module. Initializers are run when the
module’s <code>start</code> method is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addInitializer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>)</span>{
    <span class="hljs-keyword">this</span>._initializerCallbacks.add(callback);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Finalizers are run when a module is stopped. They are used to teardown
and finalize any variables, references, events and other code that the
module had set up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addFinalizer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>)</span>{
    <span class="hljs-keyword">this</span>._finalizerCallbacks.add(callback);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Start the module, and run all of it’s initializers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  start: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
    <span class="hljs-keyword">this</span>._runModuleDefinition();
    <span class="hljs-keyword">this</span>._initializerCallbacks.run(options, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>._isInitialized = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>start the sub-modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.submodules){
      _.each(<span class="hljs-keyword">this</span>.submodules, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mod</span>)</span>{
        mod.start();
      });
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Stop this module by running its finalizers and then stop all of
the sub-modules for this module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  stop: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>if we are not initialized, don’t bother finalizing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isInitialized){ <span class="hljs-keyword">return</span>; }
    <span class="hljs-keyword">this</span>._isInitialized = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>._finalizerCallbacks.run();</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>stop the sub-modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(<span class="hljs-keyword">this</span>.submodules, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mod</span>)</span>{ mod.stop(); });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Configure the module with a definition function and any custom args
that are to be passed in to the definition function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addDefinition: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">moduleDefinition</span>)</span>{
    <span class="hljs-keyword">this</span>._config.definitions.push(moduleDefinition);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Internal method: run the module definition function with the correct
arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _runModuleDefinition: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._config.definitions.length === <span class="hljs-number">0</span>) { <span class="hljs-keyword">return</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>build the correct list of arguments for the module definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> args = _.flatten([
      <span class="hljs-keyword">this</span>, 
      <span class="hljs-keyword">this</span>._config.app, 
      Backbone, 
      Marionette, 
      $, _, 
      <span class="hljs-keyword">this</span>._config.customArgs
    ]);</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>run the module definition function with the correct args</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> definitionCount = <span class="hljs-keyword">this</span>._config.definitions.length<span class="hljs-number">-1</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt;= definitionCount; i++){

      <span class="hljs-keyword">var</span> definition = <span class="hljs-keyword">this</span>._config.definitions[i];
      definition.apply(<span class="hljs-keyword">this</span>, args);

    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Function level methods to create modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.extend(Marionette.Module, {</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Create a module, hanging off the app parameter as the parent object. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  create: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">app, moduleNames, moduleDefinition</span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> parentModule = app;
    <span class="hljs-keyword">var</span> moduleNames = moduleNames.split(<span class="hljs-string">"."</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>get the custom args passed in after the module definition and
get rid of the module name and definition function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> customArgs = slice.apply(<span class="hljs-built_in">arguments</span>);
    customArgs.splice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Loop through all the parts of the module definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> length = moduleNames.length;
    _.each(moduleNames, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">moduleName, i</span>)</span>{
      <span class="hljs-keyword">var</span> isLastModuleInChain = (i === length<span class="hljs-number">-1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Get an existing module of this name if we have one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = parentModule[moduleName];
      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">module</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Create a new module if we don’t have one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">module</span> = <span class="hljs-keyword">new</span> Marionette.Module(moduleName, app, customArgs);
        parentModule[moduleName] = <span class="hljs-built_in">module</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>store the module on the parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        parentModule.submodules[moduleName] = <span class="hljs-built_in">module</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Only add a module definition and initializer when this is
the last module in a “parent.child.grandchild” hierarchy of
module names</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (isLastModuleInChain ){
        that._createModuleDefinition(<span class="hljs-built_in">module</span>, moduleDefinition, app);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Reset the parent module so that the next child
in the list will be added to the correct parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      parentModule = <span class="hljs-built_in">module</span>;
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Return the last module in the definition chain</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> parentModule;
  },

  <span class="hljs-attr">_createModuleDefinition</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">module, moduleDefinition, app</span>)</span>{
    <span class="hljs-keyword">var</span> moduleOptions = <span class="hljs-keyword">this</span>._getModuleDefinitionOptions(moduleDefinition);</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>add the module definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (moduleOptions.definition){
      <span class="hljs-built_in">module</span>.addDefinition(moduleOptions.definition);
    }

    <span class="hljs-keyword">if</span> (moduleOptions.startWithApp){</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>start the module when the app starts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      app.addInitializer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>)</span>{
        <span class="hljs-built_in">module</span>.start(options);
      });
    }
  },

  <span class="hljs-attr">_getModuleDefinitionOptions</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">moduleDefinition</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>default to starting the module with the app</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> options = { <span class="hljs-attr">startWithApp</span>: <span class="hljs-literal">true</span> };</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>short circuit if we don’t have a module definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!moduleDefinition){ <span class="hljs-keyword">return</span> options; }

    <span class="hljs-keyword">if</span> (_.isFunction(moduleDefinition)){</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>if the definition is a function, assign it directly
and use the defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.definition = moduleDefinition;

    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>the definition is an object. grab the “define” attribute
and the “startWithApp” attribute, as set the options
appropriately</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.definition = moduleDefinition.define;
      <span class="hljs-keyword">if</span> (moduleDefinition.hasOwnProperty(<span class="hljs-string">"startWithApp"</span>)){
        options.startWithApp = moduleDefinition.startWithApp;
      }
    }

    <span class="hljs-keyword">return</span> options;
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <h2 id="template-cache">Template Cache</h2>

            </div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Manage templates stored in <code>&lt;script&gt;</code> blocks,
caching them for faster access.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.TemplateCache = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">templateId</span>)</span>{
  <span class="hljs-keyword">this</span>.templateId = templateId;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>TemplateCache object-level methods. Manage the template
caches from these method calls instead of creating 
your own TemplateCache instances</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.extend(Marionette.TemplateCache, {
  <span class="hljs-attr">templateCaches</span>: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Get the specified template by id. Either
retrieves the cached version, or loads it
from the DOM.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  get: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">templateId</span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> cachedTemplate = <span class="hljs-keyword">this</span>.templateCaches[templateId];

    <span class="hljs-keyword">if</span> (!cachedTemplate){
      cachedTemplate = <span class="hljs-keyword">new</span> Marionette.TemplateCache(templateId);
      <span class="hljs-keyword">this</span>.templateCaches[templateId] = cachedTemplate;
    }

    <span class="hljs-keyword">return</span> cachedTemplate.load();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Clear templates from the cache. If no arguments
are specified, clears all templates:
<code>clear()</code></p>
<p>If arguments are specified, clears each of the 
specified templates from the cache:
<code>clear(&quot;#t1&quot;, &quot;#t2&quot;, &quot;...&quot;)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clear: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> i;
    <span class="hljs-keyword">var</span> length = <span class="hljs-built_in">arguments</span>.length;

    <span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">0</span>){
      <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;length; i++){
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.templateCaches[<span class="hljs-built_in">arguments</span>[i]];
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.templateCaches = {};
    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>TemplateCache instance methods, allowing each
template cache object to manage it’s own state
and know whether or not it has been loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.extend(Marionette.TemplateCache.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Internal method to load the template asynchronously.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  load: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Guard clause to prevent loading this template more than once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.compiledTemplate){
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.compiledTemplate;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Load the template and compile it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> template = <span class="hljs-keyword">this</span>.loadTemplate(<span class="hljs-keyword">this</span>.templateId);
    <span class="hljs-keyword">this</span>.compiledTemplate = <span class="hljs-keyword">this</span>.compileTemplate(template);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.compiledTemplate;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Load a template from the DOM, by default. Override
this method to provide your own template retrieval,
such as asynchronous loading from a server.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  loadTemplate: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">templateId</span>)</span>{
    <span class="hljs-keyword">var</span> template = $(templateId).html();

    <span class="hljs-keyword">if</span> (!template || template.length === <span class="hljs-number">0</span>){
      <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"Could not find template: '"</span> + templateId + <span class="hljs-string">"'"</span>;
      <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(msg);
      err.name = <span class="hljs-string">"NoTemplateError"</span>;
      <span class="hljs-keyword">throw</span> err;
    }

    <span class="hljs-keyword">return</span> template;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Pre-compile the template before caching it. Override
this method if you do not need to pre-compile a template
(JST / RequireJS for example) or if you want to change
the template engine used (Handebars, etc).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  compileTemplate: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawTemplate</span>)</span>{
    <span class="hljs-keyword">return</span> _.template(rawTemplate);
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <h2 id="renderer">Renderer</h2>

            </div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Render a template with data by passing in the template
selector and the data to render.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Renderer = {</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Render a template with data. The <code>template</code> parameter is
passed to the <code>TemplateCache</code> object to retrieve the
template function. Override this method to provide your own
custom rendering and template handling for all of Marionette.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">template, data</span>)</span>{
    <span class="hljs-keyword">var</span> templateFunc = Marionette.TemplateCache.get(template);
    <span class="hljs-keyword">var</span> html = templateFunc(data);
    <span class="hljs-keyword">return</span> html;
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <h2 id="callbacks">Callbacks</h2>

            </div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>A simple way of managing a collection of callbacks
and executing them at a later point in time, using jQuery’s
<code>Deferred</code> object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.Callbacks = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">this</span>.deferred = $.Deferred();
  <span class="hljs-keyword">this</span>.promise = <span class="hljs-keyword">this</span>.deferred.promise();
};

_.extend(Marionette.Callbacks.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Add a callback to be executed. Callbacks added here are
guaranteed to execute, even if they are added after the 
<code>run</code> method is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback, contextOverride</span>)</span>{
    <span class="hljs-keyword">this</span>.promise.done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context, options</span>)</span>{
      <span class="hljs-keyword">if</span> (contextOverride){ context = contextOverride; }
      callback.call(context, options);
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Run all registered callbacks with the context specified. 
Additional callbacks can be added after this has been run 
and they will still be executed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  run: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options, context</span>)</span>{
    <span class="hljs-keyword">this</span>.deferred.resolve(context, options);
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <h2 id="event-aggregator">Event Aggregator</h2>

            </div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>A pub-sub object that can be used to decouple various parts
of an application through event-driven architecture.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.EventAggregator = Marionette.EventBinder.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Extend any provided options directly on to the event binder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">constructor</span>: function(options){
    Marionette.EventBinder.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    _.extend(<span class="hljs-keyword">this</span>, options);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Override the <code>bindTo</code> method to ensure that the event aggregator
is used as the event binding storage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  bindTo: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">eventName, callback, context</span>)</span>{
    <span class="hljs-keyword">return</span> Marionette.EventBinder.prototype.bindTo.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>, eventName, callback, context);
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Copy the basic Backbone.Events on to the event aggregator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.extend(Marionette.EventAggregator.prototype, Backbone.Events);</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Copy the <code>extend</code> function used by Backbone’s classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Marionette.EventAggregator.extend = Backbone.View.extend;</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <h2 id="helpers">Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>For slicing <code>arguments</code> in functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> slice = <span class="hljs-built_in">Array</span>.prototype.slice;


  <span class="hljs-keyword">return</span> Marionette;
})(Backbone, _, <span class="hljs-built_in">window</span>.jQuery || <span class="hljs-built_in">window</span>.Zepto || <span class="hljs-built_in">window</span>.ender);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
